<template>
    <template if:true={isShown}>
        <li class="slds-p-top_small" aria-expanded={isExpanded} ondrop={drop} aria-level={node.level} role="treeitem" tabindex="0">
            <div style="border-bottom:solid 1px #b3cff0;border-radius: 0px; width: 95%;" aria-level={node.level}  class="drag-div" onclick={expandNode} draggable={isDragable} ondragleave={dragLeave}
                ondragover={dragOver} ondragstart={drag}>
                <template if:false={node.new}>
                    <lightning-layout class="slds-tree__item" multiple-rows>
                        <!-- expaned icon -->
                        <lightning-layout-item class="slds-p-top_xx-small">
                            <template if:true={isNotLeaf}>
                                <lightning-icon aria-hidden="true" class="slds-m-right_x-small" size="xx-small"
                                    if:true={isExpanded} icon-name="utility:chevrondown"></lightning-icon>
                                    <template if:true={isRTL}>
                                        <lightning-icon aria-hidden="true" class="slds-m-right_x-small" size="xx-small"
                                    if:false={isExpanded} icon-name="utility:chevronleft"></lightning-icon>
                                    </template>
                                    <template if:false={isRTL}>
                                        <lightning-icon aria-hidden="true" class="slds-m-right_x-small" size="xx-small"
                                    if:false={isExpanded} icon-name="utility:chevronright"></lightning-icon>
                                    </template>
                                    
                            </template>
                            <template if:false={isNotLeaf}>
                                <lightning-icon aria-hidden="true" style="visibility:none;" class="slds-m-right_x-small"
                                    size="xx-small"></lightning-icon>
                            </template>
                        </lightning-layout-item>
                        <!-- label -->
                        <lightning-layout-item size="4" style="margin-top:4px">
                            <span style="font-size: 16px;white-space: break-spaces;" ondblclick={editNode} onmousedown={openRecord} class="slds-has-flexi-truncate">
                                <span if:true={node.markable} class="slds-tree__item-label mark-search"
                                    title="Tree Branch">{node.label}</span>
                                <span if:false={node.markable} class="slds-tree__item-label"
                                    title="Tree Branch">{node.label}</span>
                            </span>
                        </lightning-layout-item>
                        <!-- actions -->
                        <template if:true={hasPermission}>
                            <lightning-layout-item size="4" style="margin-top:3px;" flexibility="no-flex" padding="horizontal-small">
                                <c-tree-admin-actions ondeletenode={deleteNode} oninsertnode={insertNode} oneditnode={editNode} onorderup={orderUp} onorderdown={orderDown} is-first={isFirst} is-last={isLast}></c-tree-admin-actions>
                            </lightning-layout-item>
                        </template>
                        <lightning-layout-item if:true={hasDescrption} style="max-width: 95%;" size=10 >
                            <div class="slds-grid slds-gutters">
                                <div class="slds-col slds-size_11-of-12" style="width:fit-content;padding-left:2.1em;padding-right:2.0em;padding-top:1.2em;padding-bottom:1.2em" if:false={closeDescrption}>
                                    <template if:true={isArticleSource}>
                                        <div class="slds-p-around_small slds-border_top slds-border_right slds-border_bottom slds-border_left">
                                            <lightning-formatted-rich-text  value={node.articleHtml}>
                                            </lightning-formatted-rich-text>
                                        </div>
                                    </template>
                                    <template if:false={isArticleSource}>
                                        <template if:true={node.richText}>
                                            <div class="slds-p-around_small slds-border_top slds-border_right slds-border_bottom slds-border_left">
                                                <lightning-formatted-rich-text  value={node.richText}>
                                                </lightning-formatted-rich-text>
                                            </div>
                                        </template>
                                    </template>
                                    <!-- <div class="slds-m-around_small">
                                        <lightning-button class="best-answer" variant="success" label="MARK AS A BEST ANSWER" icon-name="utility:favorite"></lightning-button>
                                    </div> -->
                                </div>
                                <template if:true={hasDescrption}>
                                    <div style="padding-left:32px;" class="slds-col slds-size_3-of-12" if:true={closeDescrption}>
                                       {labels.ContentAvailable}
                                    </div>
                                </template>
                                <div if:true={hasDescrption}>
                                    <div class="slds-col slds-size_1-of-12" if:false={closeDescrption}>
                                        <lightning-button-icon class="show-content" title={labels.HideContent} icon-name="utility:dash" size="x-small" onclick={openCloseDescrption}></lightning-button-icon>
                                    </div>
                                    <div class="slds-col" if:true={closeDescrption}>
                                        <lightning-button-icon class="show-content" title={labels.ViewContent} icon-name="utility:expand" size="x-small" onclick={openCloseDescrption}></lightning-button-icon>
                                    </div>
                                </div>
                            </div>
                        </lightning-layout-item>
                    </lightning-layout>
                    
                </template>
               
                <c-node-editor if:true={node.new} articles-options={articlesOptions} contents-options={contentsOptions} is-dragable={isDragable} node={node}
                onenterevent={enterHandler} oncancelevent={cancelHandler} onnewnodeevent={setNewNode}
                oncontentselected ={handleSelection} onarticleselected={handleSelectionArticle}
                ></c-node-editor>
            </div>
            <ul role="group">
                <template if:true={node.items} for:each={node.items} for:item="item">
                    <c-tree-node-item if:true={item} new-search={newSearch} has-permission={hasPermission} ondraftevent={removeDraft}
                        articles-options={articlesOptions} contents-options={contentsOptions} key={item.nodeId}
                        node={item} html-str={htmlStr}>
                    </c-tree-node-item>
                </template>
            </ul>
        </li>
    </template>
</template>